<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Inscripción Estudiantil</title>
    <!-- Carga de Tailwind CSS para estilos rápidos y responsivos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para la fuente Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Oculta los pasos por defecto, el JS los mostrará */
        .form-step {
            display: none;
        }
        /* Asegura que el paso activo se muestre */
        .form-step.active {
            display: block;
        }
        /* Estilo para los campos de entrada al enfocarse */
        input:focus, textarea:focus, select:focus {
            outline: none !important;
            border-color: #6366f1 !important; /* Color índigo */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5) !important; /* Sombra índigo */
        }

        /* Estilos para el indicador de progreso */
        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 9999px; /* rounded-full */
            height: 8px; /* h-2 */
            overflow: hidden;
            margin-bottom: 1.5rem; /* mb-6 */
        }
        .progress-bar {
            height: 100%;
            background-color: #4f46e5; /* indigo-600 */
            width: 0%; /* Se controla con JS */
            border-radius: 9999px; /* rounded-full */
            transition: width 0.5s ease-in-out;
        }

        /* Estilos para el modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2.5rem; /* p-10 */
            border-radius: 1rem; /* rounded-2xl */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); /* shadow-2xl */
            text-align: center;
            max-width: 90%;
            width: 400px;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gradient-to-r from-blue-500 to-purple-600 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white p-8 rounded-2xl shadow-xl max-w-2xl w-full rounded-2xl transform transition-all duration-300 hover:scale-105">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-6 text-center">
            Ficha de Inscripción Estudiantil
        </h1>
        <p class="text-lg text-gray-700 mb-8 text-center" id="form-description">
            Por favor, completa los datos del estudiante y selecciona las secciones opcionales.
        </p>

        <!-- Indicador de Progreso -->
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>

        <!-- Formulario de Inscripción -->
        <!-- URL de Google Apps Script para el envío del formulario -->
        <form action="https://script.google.com/macros/s/AKfycbxbf6PPA4FhqmTj7SHa6fVREft47NPGB4ZQ9Z7Lvr8gkzjvbc41tuWzYDTds4bsDEiLfw/exec" method="POST" class="space-y-6" id="studentForm">

            <!-- Paso 1: Datos del Estudiante y Opciones -->
            <div id="step1" class="form-step">
                <fieldset class="border border-gray-300 p-6 rounded-lg shadow-sm mb-6">
                    <legend class="text-2xl font-semibold text-gray-800 mb-4 px-2">Opciones de Ficha</legend>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" id="enableMadre" checked class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-colors duration-200">
                            <label for="enableMadre" class="ml-2 block text-base font-medium text-gray-700">Incluir Datos Madre</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="enablePadre" checked class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-colors duration-200">
                            <label for="enablePadre" class="ml-2 block text-base font-medium text-gray-700">Incluir Datos Padre</label>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="border border-gray-300 p-6 rounded-lg shadow-sm">
                    <legend class="text-2xl font-semibold text-gray-800 mb-4 px-2">Datos del Estudiante</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- AÑO A CURSAR - AHORA ES UN SELECT Y VA PRIMERO -->
                        <div>
                            <label for="ano_cursar" class="block text-sm font-medium text-gray-700">Año a Cursar:</label>
                            <select name="ano_cursar" id="ano_cursar"
                                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                                <!-- Opciones generadas por JavaScript -->
                            </select>
                        </div>
                        <!-- AÑO ESCOLAR - AHORA ES UN SELECT -->
                        <div>
                            <label for="anoEsc" class="block text-sm font-medium text-gray-700">Año Escolar:</label>
                            <select name="anoEsc" id="anoEsc"
                                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                                <option value="">Selecciona</option>
                                <option value="1°">1°</option>
                                <option value="2°">2°</option>
                                <option value="3°">3°</option>
                                <option value="4°">4°</option>
                                <option value="5°">5°</option>
                            </select>
                        </div>
                        <div>
                            <label for="nomEst" class="block text-sm font-medium text-gray-700">Nombres:</label>
                            <input type="text" name="nomEst" id="nomEst"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="apeEst" class="block text-sm font-medium text-gray-700">Apellidos:</label>
                            <input type="text" name="apeEst" id="apeEst"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="ciEst" class="block text-sm font-medium text-gray-700">Cédula:</label>
                            <input type="text" name="ciEst" id="ciEst" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="sexoEst" class="block text-sm font-medium text-gray-700">Sexo:</label>
                            <select name="sexoEst" id="sexoEst"
                                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                                <option value="">Selecciona</option>
                                <option value="M">Masculino</option>
                                <option value="F">Femenino</option>
                            </select>
                        </div>
                        <div>
                            <label for="fNacEst" class="block text-sm font-medium text-gray-700">Fecha de Nacimiento:</label>
                            <input type="date" name="fNacEst" id="fNacEst"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="edadEst" class="block text-sm font-medium text-gray-700">Edad:</label>
                            <input type="number" name="edadEst" id="edadEst" readonly
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="lugNacEst" class="block text-sm font-medium text-gray-700">Lugar de Nacimiento:</label>
                            <input type="text" name="lugNacEst" id="lugNacEst"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <!-- ESTADO DE NACIMIENTO - AHORA ES UN SELECT -->
                        <div>
                            <label for="estNacEst" class="block text-sm font-medium text-gray-700">Estado de Nacimiento:</label>
                            <select name="estNacEst" id="estNacEst"
                                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                                <option value="">Selecciona un estado</option>
                                <option value="Amazonas">Amazonas</option>
                                <option value="Anzoátegui">Anzoátegui</option>
                                <option value="Apure">Apure</option>
                                <option value="Aragua">Aragua</option>
                                <option value="Barinas">Barinas</option>
                                <option value="Bolívar">Bolívar</option>
                                <option value="Carabobo">Carabobo</option>
                                <option value="Cojedes">Cojedes</option>
                                <option value="Delta Amacuro">Delta Amacuro</option>
                                <option value="Distrito Capital">Distrito Capital</option>
                                <option value="Falcón">Falcón</option>
                                <option value="Guárico">Guárico</option>
                                <option value="La Guaira">La Guaira</option>
                                <option value="Lara">Lara</option>
                                <option value="Mérida">Mérida</option>
                                <option value="Miranda">Miranda</option>
                                <option value="Monagas">Monagas</option>
                                <option value="Nueva Esparta">Nueva Esparta</option>
                                <option value="Portuguesa">Portuguesa</option>
                                <option value="Sucre">Sucre</option>
                                <option value="Táchira">Táchira</option>
                                <option value="Trujillo">Trujillo</option>
                                <option value="Yaracuy">Yaracuy</option>
                                <option value="Zulia">Zulia</option>
                            </select>
                        </div>
                        <div>
                            <label for="plantelProc" class="block text-sm font-medium text-gray-700">Plantel de Procedencia:</label>
                            <input type="text" name="plantelProc" id="plantelProc"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div class="md:col-span-2">
                            <label for="dirHabEst" class="block text-sm font-medium text-gray-700">Dirección de Habitación:</label>
                            <textarea name="dirHabEst" id="dirHabEst" rows="2"
                                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 resize-y"></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label for="enfDisc" class="block text-sm font-medium text-gray-700">Alguna Enfermedad y/o Discapacidad:</label>
                            <input type="text" name="enfDisc" id="enfDisc"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="corrEst" class="block text-sm font-medium text-gray-700">Correo Electrónico Estudiante:</label>
                            <input type="email" name="corrEst" id="corrEst"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div class="md:col-span-2 flex items-center space-x-4">
                            <label class="block text-sm font-medium text-gray-700">Tiene hermanos en el plantel:</label>
                            <input type="radio" name="tieneHerm" id="tieneHermSi" value="Sí" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded transition-colors duration-200">
                            <label for="tieneHermSi" class="text-sm font-medium text-gray-700">Sí</label>
                            <input type="radio" name="tieneHerm" id="tieneHermNo" value="No" checked class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded transition-colors duration-200">
                            <label for="tieneHermNo" class="text-sm font-medium text-gray-700">No</label>
                        </div>
                        <div id="hermanoInfo" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:col-span-2 hidden">
                            <div>
                                <label for="nomHerm" class="block text-sm font-medium text-gray-700">Nombre Hermano:</label>
                                <input type="text" name="nomHerm" id="nomHerm"
                                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                            </div>
                            <div>
                                <label for="anoHerm" class="block text-sm font-medium text-gray-700">Año Hermano:</label>
                                <input type="text" name="anoHerm" id="anoHerm"
                                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                            </div>
                        </div>
                        <!-- ESTATURA - AHORA ES UN SELECT -->
                        <div>
                            <label for="estatura" class="block text-sm font-medium text-gray-700">Estatura (cm):</label>
                            <select name="estatura" id="estatura"
                                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                                <!-- Opciones generadas por JavaScript -->
                            </select>
                        </div>
                        <!-- TALLA CAMISA - AHORA ES UN SELECT -->
                        <div>
                            <label for="tCamisa" class="block text-sm font-medium text-gray-700">Talla Camisa:</label>
                            <select name="tCamisa" id="tCamisa"
                                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                                <option value="">Selecciona</option>
                                <option value="XS">XS</option>
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="XXL">XXL</option>
                            </select>
                        </div>
                        <!-- TALLA PANTALÓN - AHORA ES UN SELECT -->
                        <div>
                            <label for="tPantalon" class="block text-sm font-medium text-gray-700">Talla Pantalón:</label>
                            <select name="tPantalon" id="tPantalon"
                                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                                <option value="">Selecciona</option>
                                <option value="28">28</option>
                                <option value="30">30</option>
                                <option value="32">32</option>
                                <option value="34">34</option>
                                <option value="36">36</option>
                                <option value="38">38</option>
                                <option value="40">40</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label for="actInt" class="block text-sm font-medium text-gray-700">Actividad de Interés:</label>
                            <input type="text" name="actInt" id="actInt"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                    </div>
                </fieldset>
            </div>

            <!-- Paso 2: Datos Madre -->
            <div id="step2" class="form-step">
                <fieldset class="border border-gray-300 p-6 rounded-lg shadow-sm">
                    <legend class="text-2xl font-semibold text-gray-800 mb-4 px-2">Datos Madre</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="nomMad" class="block text-sm font-medium text-gray-700">Nombres y Apellidos:</label>
                            <input type="text" name="nomMad" id="nomMad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="ciMad" class="block text-sm font-medium text-gray-700">C.I.:</label>
                            <input type="text" name="ciMad" id="ciMad" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="telHabMad" class="block text-sm font-medium text-gray-700">Teléfono Habitación (NO CELULAR):</label>
                            <input type="tel" name="telHabMad" id="telHabMad" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="celMad" class="block text-sm font-medium text-gray-700">Celular:</label>
                            <input type="tel" name="celMad" id="celMad" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div class="md:col-span-2">
                            <label for="dirHabMad" class="block text-sm font-medium text-gray-700">Dirección de Habitación:</label>
                            <textarea name="dirHabMad" id="dirHabMad" rows="2"
                                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 resize-y"></textarea>
                        </div>
                        <div>
                            <label for="profMad" class="block text-sm font-medium text-gray-700">Profesión:</label>
                            <input type="text" name="profMad" id="profMad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="trabMad" class="block text-sm font-medium text-gray-700">Dónde Trabaja:</label>
                            <input type="text" name="trabMad" id="trabMad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="cargoMad" class="block text-sm font-medium text-gray-700">Cargo:</label>
                            <input type="text" name="cargoMad" id="cargoMad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div class="md:col-span-2">
                            <label for="dirTrabMad" class="block text-sm font-medium text-gray-700">Dirección del Trabajo:</label>
                            <textarea name="dirTrabMad" id="dirTrabMad" rows="2"
                                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 resize-y"></textarea>
                        </div>
                        <div>
                            <label for="corrMad" class="block text-sm font-medium text-gray-700">Correo Electrónico Madre:</label>
                            <input type="email" name="corrMad" id="corrMad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                    </div>
                </fieldset>
            </div>

            <!-- Paso 3: Datos Padre -->
            <div id="step3" class="form-step">
                <fieldset class="border border-gray-300 p-6 rounded-lg shadow-sm">
                    <legend class="text-2xl font-semibold text-gray-800 mb-4 px-2">Datos Padre</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="nomPad" class="block text-sm font-medium text-gray-700">Nombres y Apellidos:</label>
                            <input type="text" name="nomPad" id="nomPad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="ciPad" class="block text-sm font-medium text-gray-700">C.I.:</label>
                            <input type="text" name="ciPad" id="ciPad" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="telHabPad" class="block text-sm font-medium text-gray-700">Teléfono Habitación (NO CELULAR):</label>
                            <input type="tel" name="telHabPad" id="telHabPad" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="celPad" class="block text-sm font-medium text-gray-700">Celular:</label>
                            <input type="tel" name="celPad" id="celPad" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div class="md:col-span-2">
                            <label for="dirHabPad" class="block text-sm font-medium text-gray-700">Dirección de Habitación:</label>
                            <textarea name="dirHabPad" id="dirHabPad" rows="2"
                                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 resize-y"></textarea>
                        </div>
                        <div>
                            <label for="profPad" class="block text-sm font-medium text-gray-700">Profesión:</label>
                            <input type="text" name="profPad" id="profPad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="trabPad" class="block text-sm font-medium text-gray-700">Dónde Trabaja:</label>
                            <input type="text" name="trabPad" id="trabPad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="cargoPad" class="block text-sm font-medium text-gray-700">Cargo:</label>
                            <input type="text" name="cargoPad" id="cargoPad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div class="md:col-span-2">
                            <label for="dirTrabPad" class="block text-sm font-medium text-gray-700">Dirección del Trabajo:</label>
                            <textarea name="dirTrabPad" id="dirTrabPad" rows="2"
                                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 resize-y"></textarea>
                        </div>
                        <div>
                            <label for="corrPad" class="block text-sm font-medium text-gray-700">Correo Electrónico Padre:</label>
                            <input type="email" name="corrPad" id="corrPad"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                    </div>
                </fieldset>
            </div>

            <!-- Paso 4: Datos del Representante en el Colegio (Siempre incluido) -->
            <div id="step4" class="form-step">
                <fieldset class="border border-gray-300 p-6 rounded-lg shadow-sm">
                    <legend class="text-2xl font-semibold text-gray-800 mb-4 px-2">Datos del Representante en el Colegio</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="nomRep" class="block text-sm font-medium text-gray-700">Nombres y Apellidos Representante:</label>
                            <input type="text" name="nomRep" id="nomRep"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="ciRep" class="block text-sm font-medium text-gray-700">C.I.:</label>
                            <input type="text" name="ciRep" id="ciRep" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="telHabRep" class="block text-sm font-medium text-gray-700">Teléfono Habitación (NO CELULAR):</label>
                            <input type="tel" name="telHabRep" id="telHabRep" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="celRep" class="block text-sm font-medium text-gray-700">Celular:</label>
                            <input type="tel" name="celRep" id="celRep" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div class="md:col-span-2">
                            <label for="dirHabRep" class="block text-sm font-medium text-gray-700">Dirección de Habitación:</label>
                            <textarea name="dirHabRep" id="dirHabRep" rows="2"
                                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 resize-y"></textarea>
                        </div>
                        <div>
                            <label for="profRep" class="block text-sm font-medium text-gray-700">Profesión:</label>
                            <input type="text" name="profRep" id="profRep"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="trabRep" class="block text-sm font-medium text-gray-700">Dónde Trabaja:</label>
                            <input type="text" name="trabRep" id="trabRep"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="cargoRep" class="block text-sm font-medium text-gray-700">Cargo:</label>
                            <input type="text" name="cargoRep" id="cargoRep"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div class="md:col-span-2">
                            <label for="dirTrabRep" class="block text-sm font-medium text-gray-700">Dirección del Trabajo:</label>
                            <textarea name="dirTrabRep" id="dirTrabRep" rows="2"
                                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 resize-y"></textarea>
                        </div>
                        <div>
                            <label for="corrRep" class="block text-sm font-medium text-gray-700">Correo Electrónico Representante:</label>
                            <input type="email" name="corrRep" id="corrRep"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="parentesco" class="block text-sm font-medium text-gray-700">Parentesco con el Estudiante:</label>
                            <input type="text" name="parentesco" id="parentesco"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div>
                            <label for="contEmerg" class="block text-sm font-medium text-gray-700">Contacto de Emergencia:</label>
                            <input type="tel" name="contEmerg" id="contEmerg" inputmode="numeric"
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        </div>
                        <div class="md:col-span-2">
                            <label for="autRetirar" class="block text-sm font-medium text-gray-700">Personas Autorizadas para Retirar al Menor:</label>
                            <textarea name="autRetirar" id="autRetirar" rows="2"
                                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 resize-y"></textarea>
                        </div>
                    </div>
                </fieldset>
            </div>

        </form>

        <!-- Botones de Navegación y Estado del Formulario (fuera del form-step) -->
        <div class="flex justify-between mt-6">
            <button type="button" id="prevStepBtn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300 focus:ring-opacity-50 hidden">
                Anterior
            </button>
            <button type="button" id="nextStepBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
                Siguiente
            </button>
            <button type="submit" form="studentForm" id="submitForm" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 hidden">
                Generar Ficha
            </button>
        </div>

        <p id="formStatus" class="mt-6 text-xl font-semibold text-gray-800 text-center hidden"></p>
        <p id="documentLink" class="mt-4 text-center hidden">
            <a href="#" target="_blank" class="text-indigo-600 hover:text-indigo-800 font-semibold underline">Ver Documento Generado</a>
        </p>
    </div>

    <!-- Modal de Confirmación -->
    <div id="confirmationModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">¡Ficha Generada con Éxito!</h2>
            <p class="text-lg text-gray-700 mb-6">
                Por favor, revisa tu correo electrónico para descargar el archivo de la ficha.
                Una vez descargado, puedes imprimirlo.
            </p>
            <button type="button" id="closeModalBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
                Cerrar
            </button>
        </div>
    </div>

    <script>
        const studentForm = document.getElementById('studentForm');
        const formStatus = document.getElementById('formStatus');
        const documentLink = document.getElementById('documentLink');
        const documentLinkAnchor = document.querySelector('#documentLink a');
        const formDescription = document.getElementById('form-description');
        const progressBar = document.getElementById('progressBar');

        const formSteps = document.querySelectorAll('.form-step'); // Todos los divs de paso
        let currentStepIndex = 0; // Índice en el array `visibleSteps`
        let visibleSteps = []; // IDs de los pasos que están actualmente activos en la navegación

        // Elementos de los botones de navegación
        const prevStepBtn = document.getElementById('prevStepBtn');
        const nextStepBtn = document.getElementById('nextStepBtn');
        const submitFormBtn = document.getElementById('submitForm');

        // Checkboxes para las secciones opcionales
        const enableMadreCheckbox = document.getElementById('enableMadre');
        const enablePadreCheckbox = document.getElementById('enablePadre');

        // Modal elements
        const confirmationModal = document.getElementById('confirmationModal');
        const closeModalBtn = document.getElementById('closeModalBtn');

        const stepDescriptions = {
            'step1': "Por favor, completa los datos del estudiante y selecciona las secciones opcionales.",
            'step2': "Ahora, ingresa los datos de la madre.",
            'step3': "A continuación, ingresa los datos del padre.",
            'step4': "Finalmente, completa los datos del representante en el colegio."
        };

        // Function to update the array of visible steps
        function updateVisibleSteps() {
            visibleSteps = ['step1']; // Step 1 is always visible
            if (enableMadreCheckbox.checked) {
                visibleSteps.push('step2');
            }
            if (enablePadreCheckbox.checked) {
                visibleSteps.push('step3');
            }
            // Step 4 (representative) is always included if its div exists
            if (document.getElementById('step4')) {
                visibleSteps.push('step4');
            }
            // Ensure current index is valid if options change
            if (currentStepIndex >= visibleSteps.length) {
                currentStepIndex = visibleSteps.length - 1;
            }
            showCurrentStep(); // Show current step after updating the list
            updateProgressBar();
        }

        // Function to update the progress bar
        function updateProgressBar() {
            const progress = ((currentStepIndex + 1) / visibleSteps.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Function to show the current step and hide others
        function showCurrentStep() {
            formSteps.forEach(step => step.classList.remove('active')); // Hide all steps
            const currentStepId = visibleSteps[currentStepIndex];
            document.getElementById(currentStepId).classList.add('active'); // Show current step

            // Update form description
            formDescription.textContent = stepDescriptions[currentStepId];

            // Update visibility of navigation buttons
            if (currentStepIndex === 0) {
                prevStepBtn.classList.add('hidden');
            } else {
                prevStepBtn.classList.remove('hidden');
            }

            if (currentStepIndex === visibleSteps.length - 1) {
                nextStepBtn.classList.add('hidden');
                submitFormBtn.classList.remove('hidden');
                // Ensure formStatus and documentLink are hidden when reaching the final step before submission
                formStatus.classList.add('hidden');
                documentLink.classList.add('hidden');
            } else {
                nextStepBtn.classList.remove('hidden');
                submitFormBtn.classList.add('hidden');
                // Update next button text
                const nextStepId = visibleSteps[currentStepIndex + 1];
                if (nextStepId === 'step2') nextStepBtn.textContent = 'Siguiente: Datos Madre';
                else if (nextStepId === 'step3') nextStepBtn.textContent = 'Siguiente: Datos Padre';
                else if (nextStepId === 'step4') nextStepBtn.textContent = 'Siguiente: Datos Representante';
                else nextStepBtn.textContent = 'Siguiente'; // Fallback
            }
            updateProgressBar();
        }

        // Event listeners for navigation buttons
        nextStepBtn.addEventListener('click', () => {
            if (currentStepIndex < visibleSteps.length - 1) {
                currentStepIndex++;
                showCurrentStep();
            }
        });

        prevStepBtn.addEventListener('click', () => {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                showCurrentStep();
            }
        });

        // Event listeners for optional section checkboxes
        enableMadreCheckbox.addEventListener('change', updateVisibleSteps);
        enablePadreCheckbox.addEventListener('change', updateVisibleSteps);

        // Logic to show/hide sibling fields (within step 1)
        const tieneHermSi = document.getElementById('tieneHermSi');
        const tieneHermNo = document.getElementById('tieneHermNo');
        const hermanoInfo = document.getElementById('hermanoInfo');

        function toggleHermanoInfo() {
            if (tieneHermSi.checked) {
                hermanoInfo.classList.remove('hidden');
            } else {
                hermanoInfo.classList.add('hidden');
            }
        }

        tieneHermSi.addEventListener('change', toggleHermanoInfo);
        tieneHermNo.addEventListener('change', toggleHermanoInfo);
        // Initialize on page load
        toggleHermanoInfo();

        // Function to generate "Ano a Cursar" options
        function populateAnoCursar() {
            const selectElement = document.getElementById('ano_cursar');
            const currentYear = new Date().getFullYear();
            // Clear existing options
            selectElement.innerHTML = '';
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = "";
            defaultOption.textContent = "Selecciona un año";
            selectElement.appendChild(defaultOption);

            for (let i = 0; i < 10; i++) {
                const startYear = currentYear + i;
                const endYear = startYear + 1;
                const option = document.createElement('option');
                option.value = `${startYear}-${endYear}`;
                option.textContent = `${startYear}-${endYear}`;
                selectElement.appendChild(option);
            }
        }
        // Call function to populate select on page load
        populateAnoCursar();

        // Function to populate "Estatura" options
        function populateEstatura() {
            const selectElement = document.getElementById('estatura');
            selectElement.innerHTML = '<option value="">Selecciona</option>'; // Default option
            for (let i = 100; i <= 200; i += 5) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i} cm`;
                selectElement.appendChild(option);
            }
        }
        // Call function to populate select on page load
        populateEstatura();


        // Logic to automatically calculate age
        const fNacEstInput = document.getElementById('fNacEst');
        const edadEstInput = document.getElementById('edadEst');

        fNacEstInput.addEventListener('change', () => {
            const birthDate = new Date(fNacEstInput.value);
            if (isNaN(birthDate)) {
                edadEstInput.value = '';
                return;
            }
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            edadEstInput.value = age >= 0 ? age : ''; // Ensure age is not negative
        });

        // --- Funciones para restringir la entrada de texto en tiempo real ---

        // Restringe a solo números
        function restrictToNumbers(event) {
            // Permite solo dígitos. No permite el signo de más, menos, o punto decimal.
            this.value = this.value.replace(/[^0-9]/g, '');
        }

        // Restringe a solo letras (incluyendo acentos y ñ) y espacios
        function restrictToLetters(event) {
            // Permite letras (mayúsculas y minúsculas), letras acentuadas, ñ/Ñ y espacios
            this.value = this.value.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑüÜ\s]/g, '');
        }

        // Restringe a letras, números, espacios y algunos símbolos comunes para direcciones/nombres de planteles
        function restrictToAlphanumericSpecial(event) {
            // Permite letras, números, acentos, ñ/Ñ, espacios, puntos, comas y guiones
            this.value = this.value.replace(/[^a-zA-Z0-9áéíóúÁÉÍÓÚñÑüÜ\s.,-]/g, '');
        }

        // Asignar las funciones de restricción a los campos correspondientes
        document.addEventListener('DOMContentLoaded', () => {
            // Campos de solo números
            document.getElementById('ciEst').addEventListener('input', restrictToNumbers);
            document.getElementById('ciMad').addEventListener('input', restrictToNumbers);
            document.getElementById('ciPad').addEventListener('input', restrictToNumbers);
            document.getElementById('ciRep').addEventListener('input', restrictToNumbers);
            document.getElementById('telHabMad').addEventListener('input', restrictToNumbers);
            document.getElementById('celMad').addEventListener('input', restrictToNumbers);
            document.getElementById('telHabPad').addEventListener('input', restrictToNumbers);
            document.getElementById('celPad').addEventListener('input', restrictToNumbers);
            document.getElementById('telHabRep').addEventListener('input', restrictToNumbers);
            document.getElementById('celRep').addEventListener('input', restrictToNumbers);
            document.getElementById('contEmerg').addEventListener('input', restrictToNumbers);

            // Campos de solo letras
            document.getElementById('nomEst').addEventListener('input', restrictToLetters);
            document.getElementById('apeEst').addEventListener('input', restrictToLetters);
            document.getElementById('lugNacEst').addEventListener('input', restrictToLetters);
            document.getElementById('nomMad').addEventListener('input', restrictToLetters);
            document.getElementById('profMad').addEventListener('input', restrictToLetters);
            document.getElementById('cargoMad').addEventListener('input', restrictToLetters);
            document.getElementById('nomPad').addEventListener('input', restrictToLetters);
            document.getElementById('profPad').addEventListener('input', restrictToLetters);
            document.getElementById('cargoPad').addEventListener('input', restrictToLetters);
            document.getElementById('nomRep').addEventListener('input', restrictToLetters);
            document.getElementById('profRep').addEventListener('input', restrictToLetters);
            document.getElementById('cargoRep').addEventListener('input', restrictToLetters);
            document.getElementById('parentesco').addEventListener('input', restrictToLetters);
            document.getElementById('nomHerm').addEventListener('input', restrictToLetters); // Nombre del hermano también solo letras

            // Campos alfanuméricos con algunos símbolos (para nombres de planteles, enfermedades, actividades, trabajos)
            document.getElementById('plantelProc').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('enfDisc').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('actInt').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('trabMad').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('trabPad').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('trabRep').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('anoHerm').addEventListener('input', restrictToAlphanumericSpecial); // Año del hermano puede ser "1er año"
        });


        // Event listener for form submission (only activated on the last step)
        studentForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent traditional form submission

            // Show "generating..." message
            formStatus.textContent = 'Generando ficha... Por favor, espera.';
            formStatus.classList.remove('hidden', 'text-green-600', 'text-red-600');
            formStatus.classList.add('text-gray-800');
            documentLink.classList.add('hidden'); // Hide previous link

            try {
                // Send form data using fetch API
                const response = await fetch(studentForm.action, {
                    method: 'POST', // Always POST to send data
                    body: new FormData(studentForm) // FormData handles form fields
                });

                // Google Apps Script will return a JSON with 'result: success' and 'documentUrl' or 'result: error'
                const data = await response.json();

                if (data.result === 'success') {
                    formStatus.textContent = '¡Ficha generada con éxito!';
                    formStatus.classList.remove('text-gray-800', 'text-red-600');
                    formStatus.classList.add('text-green-600');
                    // Do NOT reset form or go to first step immediately
                    // The modal will handle the final interaction
                    
                    // Show confirmation modal
                    confirmationModal.classList.add('show');

                    // If document URL is available, update the link (optional, as they get it by email)
                    if (data.documentUrl) {
                        documentLinkAnchor.href = data.documentUrl;
                        // documentLink.classList.remove('hidden'); // Keep hidden as per new UX
                    }

                } else {
                    formStatus.textContent = `Error: ${data.error || 'Hubo un problema al generar la ficha. Intenta de nuevo.'}`;
                    formStatus.classList.remove('text-gray-800', 'text-green-600');
                    formStatus.classList.add('text-red-600');
                    documentLink.classList.add('hidden');
                }
            } catch (error) {
                console.error('Error al enviar el formulario:', error);
                formStatus.textContent = 'Hubo un error de conexión. Por favor, revisa tu internet e intenta de nuevo.';
                formStatus.classList.remove('text-gray-800', 'text-green-600');
                formStatus.classList.add('text-red-600');
                documentLink.classList.add('hidden');
            }
        });

        // Event listener for closing the modal
        closeModalBtn.addEventListener('click', () => {
            confirmationModal.classList.remove('show');
            studentForm.reset(); // Reset form after closing modal
            currentStepIndex = 0; // Reset to the first step
            updateVisibleSteps(); // Re-evaluate visible steps and return to start
            showCurrentStep(); // Show the first step after resetting
            formStatus.classList.add('hidden'); // Hide status message after closing modal
        });


        // Initial setup on page load
        updateVisibleSteps(); // Build initial array of visible steps
        showCurrentStep(); // Show the first step
    </script>
</body>
</html>
