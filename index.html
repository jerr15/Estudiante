<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Inscripción Estudiantil</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de Google Fonts para una tipografía más elegante -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        input.invalid, select.invalid, textarea.invalid {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.4) !important;
        }
        .progress-bar {
            transition: width 0.4s ease-in-out;
        }
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white p-8 sm:p-12 rounded-2xl shadow-2xl border border-gray-200 max-w-3xl w-full">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 tracking-tight">
                Ficha de Inscripción Estudiantil
            </h1>
            <p class="text-base text-gray-500 mt-2" id="form-description">
                Por favor, completa los datos del estudiante.
            </p>
        </div>

        <div class="w-full bg-gray-200 rounded-full h-2 mb-8">
            <div id="progressBar" class="bg-indigo-600 h-2 rounded-full progress-bar"></div>
        </div>

        <form action="https://script.google.com/macros/s/AKfycbxbf6PPA4FhqmTj7SHa6fVREft47NPGB4ZQ9Z7Lvr8gkzjvbc41tuWzYDTds4bsDEiLfw/exec" method="POST" id="studentForm">

            <div class="space-y-8">
                <!-- Paso 1: Datos del Estudiante y Opciones -->
                <div id="step1" class="form-step">
                    <fieldset class="bg-gray-50/50 p-6 rounded-lg">
                        <legend class="text-xl font-semibold text-gray-700 mb-4 px-2">Opciones de Ficha</legend>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <input type="checkbox" id="enableMadre" checked class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="enableMadre" class="ml-3 block text-sm font-medium text-gray-800">Incluir Datos de la Madre</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="enablePadre" checked class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="enablePadre" class="ml-3 block text-sm font-medium text-gray-800">Incluir Datos del Padre</label>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="mt-6 bg-gray-50/50 p-6 rounded-lg">
                        <legend class="text-xl font-semibold text-gray-700 mb-4 px-2">Datos del Estudiante</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="ano_cursar" class="block text-sm font-medium text-gray-700">Año a Cursar:</label>
                                <select name="ano_cursar" id="ano_cursar" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></select>
                            </div>
                            <div>
                                <label for="anoEsc" class="block text-sm font-medium text-gray-700">Año Escolar:</label>
                                <select name="anoEsc" id="anoEsc" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Selecciona</option><option value="1°">1°</option><option value="2°">2°</option><option value="3°">3°</option><option value="4°">4°</option><option value="5°">5°</option>
                                </select>
                            </div>
                            <div>
                                <label for="nomEst" class="block text-sm font-medium text-gray-700">Nombres:</label>
                                <input type="text" name="nomEst" id="nomEst" data-required="true" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="apeEst" class="block text-sm font-medium text-gray-700">Apellidos:</label>
                                <input type="text" name="apeEst" id="apeEst" data-required="true" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="ciEst" class="block text-sm font-medium text-gray-700">Cédula:</label>
                                <input type="text" name="ciEst" id="ciEst" inputmode="numeric" data-required="true" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="sexoEst" class="block text-sm font-medium text-gray-700">Sexo:</label>
                                <select name="sexoEst" id="sexoEst" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Selecciona</option><option value="M">Masculino</option><option value="F">Femenino</option>
                                </select>
                            </div>
                            <div>
                                <label for="fNacEst" class="block text-sm font-medium text-gray-700">Fecha de Nacimiento:</label>
                                <input type="date" name="fNacEst" id="fNacEst" data-required="true" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <div id="edadWarning" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                            <div>
                                <label for="edadEst" class="block text-sm font-medium text-gray-700">Edad:</label>
                                <input type="number" name="edadEst" id="edadEst" readonly class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="lugNacEst" class="block text-sm font-medium text-gray-700">Lugar de Nacimiento:</label>
                                <input type="text" name="lugNacEst" id="lugNacEst" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="estNacEst" class="block text-sm font-medium text-gray-700">Estado de Nacimiento:</label>
                                <select name="estNacEst" id="estNacEst" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Selecciona un estado</option><option value="Amazonas">Amazonas</option><option value="Anzoátegui">Anzoátegui</option><option value="Apure">Apure</option><option value="Aragua">Aragua</option><option value="Barinas">Barinas</option><option value="Bolívar">Bolívar</option><option value="Carabobo">Carabobo</option><option value="Cojedes">Cojedes</option><option value="Delta Amacuro">Delta Amacuro</option><option value="Distrito Capital">Distrito Capital</option><option value="Falcón">Falcón</option><option value="Guárico">Guárico</option><option value="La Guaira">La Guaira</option><option value="Lara">Lara</option><option value="Mérida">Mérida</option><option value="Miranda">Miranda</option><option value="Monagas">Monagas</option><option value="Nueva Esparta">Nueva Esparta</option><option value="Portuguesa">Portuguesa</option><option value="Sucre">Sucre</option><option value="Táchira">Táchira</option><option value="Trujillo">Trujillo</option><option value="Yaracuy">Yaracuy</option><option value="Zulia">Zulia</option>
                                </select>
                            </div>
                            <div>
                                <label for="plantelProc" class="block text-sm font-medium text-gray-700">Plantel de Procedencia:</label>
                                <input type="text" name="plantelProc" id="plantelProc" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="dirHabEst" class="block text-sm font-medium text-gray-700">Dirección de Habitación:</label>
                                <textarea name="dirHabEst" id="dirHabEst" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 resize-y"></textarea>
                            </div>
                            <div class="md:col-span-2">
                                <label for="enfDisc" class="block text-sm font-medium text-gray-700">Alguna Enfermedad y/o Discapacidad:</label>
                                <input type="text" name="enfDisc" id="enfDisc" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="corrEst" class="block text-sm font-medium text-gray-700">Correo Electrónico Estudiante:</label>
                                <input type="email" name="corrEst" id="corrEst" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="estatura" class="block text-sm font-medium text-gray-700">Estatura (cm):</label>
                                <select name="estatura" id="estatura" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></select>
                            </div>
                            <div>
                                <label for="tCamisa" class="block text-sm font-medium text-gray-700">Talla Camisa:</label>
                                <select name="tCamisa" id="tCamisa" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Selecciona</option><option value="XS">XS</option><option value="S">S</option><option value="M">M</option><option value="L">L</option><option value="XL">XL</option><option value="XXL">XXL</option>
                                </select>
                            </div>
                            <div>
                                <label for="tPantalon" class="block text-sm font-medium text-gray-700">Talla Pantalón:</label>
                                <select name="tPantalon" id="tPantalon" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Selecciona</option><option value="28">28</option><option value="30">30</option><option value="32">32</option><option value="34">34</option><option value="36">36</option><option value="38">38</option><option value="40">40</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <label for="actInt" class="block text-sm font-medium text-gray-700">Actividad de Interés:</label>
                                <input type="text" name="actInt" id="actInt" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2 flex items-center space-x-4">
                                <label class="block text-sm font-medium text-gray-700">Tiene hermanos en el plantel:</label>
                                <select name="tieneHerm" id="tieneHerm" class="mt-1 block px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="" selected disabled>Selecciona</option><option value="No">No</option><option value="Sí">Sí</option>
                                </select>
                            </div>
                            <div id="hermanoInfo" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:col-span-2 hidden">
                                <div>
                                    <label for="nomHerm" class="block text-sm font-medium text-gray-700">Nombre Hermano:</label>
                                    <input type="text" name="nomHerm" id="nomHerm" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="anoHerm" class="block text-sm font-medium text-gray-700">Año Hermano:</label>
                                    <select name="anoHerm" id="anoHerm" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="">Selecciona</option><option value="1°">1°</option><option value="2°">2°</option><option value="3°">3°</option><option value="4°">4°</option><option value="5°">5°</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>

                <!-- Paso 2: Datos Madre -->
                <div id="step2" class="form-step">
                    <fieldset class="bg-gray-50/50 p-6 rounded-lg">
                        <legend class="text-xl font-semibold text-gray-700 mb-4 px-2">Datos de la Madre</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="nomMad" class="block text-sm font-medium text-gray-700">Nombres y Apellidos:</label>
                                <input type="text" name="nomMad" id="nomMad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="ciMad" class="block text-sm font-medium text-gray-700">C.I.:</label>
                                <input type="text" name="ciMad" id="ciMad" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="telHabMad" class="block text-sm font-medium text-gray-700">Teléfono Habitación (NO CELULAR):</label>
                                <input type="tel" name="telHabMad" id="telHabMad" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="celMad" class="block text-sm font-medium text-gray-700">Celular:</label>
                                <input type="tel" name="celMad" id="celMad" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="dirHabMad" class="block text-sm font-medium text-gray-700">Dirección de Habitación:</label>
                                <textarea name="dirHabMad" id="dirHabMad" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 resize-y"></textarea>
                            </div>
                            <div>
                                <label for="profMad" class="block text-sm font-medium text-gray-700">Profesión:</label>
                                <input type="text" name="profMad" id="profMad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="trabMad" class="block text-sm font-medium text-gray-700">Dónde Trabaja:</label>
                                <input type="text" name="trabMad" id="trabMad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="cargoMad" class="block text-sm font-medium text-gray-700">Cargo:</label>
                                <input type="text" name="cargoMad" id="cargoMad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="dirTrabMad" class="block text-sm font-medium text-gray-700">Dirección del Trabajo:</label>
                                <textarea name="dirTrabMad" id="dirTrabMad" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 resize-y"></textarea>
                            </div>
                            <div>
                                <label for="corrMad" class="block text-sm font-medium text-gray-700">Correo Electrónico Madre:</label>
                                <input type="email" name="corrMad" id="corrMad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                    </fieldset>
                </div>

                <!-- Paso 3: Datos Padre -->
                <div id="step3" class="form-step">
                    <fieldset class="bg-gray-50/50 p-6 rounded-lg">
                        <legend class="text-xl font-semibold text-gray-700 mb-4 px-2">Datos del Padre</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="nomPad" class="block text-sm font-medium text-gray-700">Nombres y Apellidos:</label>
                                <input type="text" name="nomPad" id="nomPad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="ciPad" class="block text-sm font-medium text-gray-700">C.I.:</label>
                                <input type="text" name="ciPad" id="ciPad" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="telHabPad" class="block text-sm font-medium text-gray-700">Teléfono Habitación (NO CELULAR):</label>
                                <input type="tel" name="telHabPad" id="telHabPad" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="celPad" class="block text-sm font-medium text-gray-700">Celular:</label>
                                <input type="tel" name="celPad" id="celPad" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="dirHabPad" class="block text-sm font-medium text-gray-700">Dirección de Habitación:</label>
                                <textarea name="dirHabPad" id="dirHabPad" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 resize-y"></textarea>
                            </div>
                            <div>
                                <label for="profPad" class="block text-sm font-medium text-gray-700">Profesión:</label>
                                <input type="text" name="profPad" id="profPad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="trabPad" class="block text-sm font-medium text-gray-700">Dónde Trabaja:</label>
                                <input type="text" name="trabPad" id="trabPad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="cargoPad" class="block text-sm font-medium text-gray-700">Cargo:</label>
                                <input type="text" name="cargoPad" id="cargoPad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="dirTrabPad" class="block text-sm font-medium text-gray-700">Dirección del Trabajo:</label>
                                <textarea name="dirTrabPad" id="dirTrabPad" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 resize-y"></textarea>
                            </div>
                            <div>
                                <label for="corrPad" class="block text-sm font-medium text-gray-700">Correo Electrónico Padre:</label>
                                <input type="email" name="corrPad" id="corrPad" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                    </fieldset>
                </div>

                <!-- Paso 4: Datos del Representante -->
                <div id="step4" class="form-step">
                    <fieldset class="bg-gray-50/50 p-6 rounded-lg">
                        <legend class="text-xl font-semibold text-gray-700 mb-4 px-2">Datos del Representante en el Colegio</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="nomRep" class="block text-sm font-medium text-gray-700">Nombres y Apellidos Representante:</label>
                                <input type="text" name="nomRep" id="nomRep" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="ciRep" class="block text-sm font-medium text-gray-700">C.I.:</label>
                                <input type="text" name="ciRep" id="ciRep" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="telHabRep" class="block text-sm font-medium text-gray-700">Teléfono Habitación (NO CELULAR):</label>
                                <input type="tel" name="telHabRep" id="telHabRep" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="celRep" class="block text-sm font-medium text-gray-700">Celular:</label>
                                <input type="tel" name="celRep" id="celRep" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="dirHabRep" class="block text-sm font-medium text-gray-700">Dirección de Habitación:</label>
                                <textarea name="dirHabRep" id="dirHabRep" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 resize-y"></textarea>
                            </div>
                            <div>
                                <label for="profRep" class="block text-sm font-medium text-gray-700">Profesión:</label>
                                <input type="text" name="profRep" id="profRep" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="trabRep" class="block text-sm font-medium text-gray-700">Dónde Trabaja:</label>
                                <input type="text" name="trabRep" id="trabRep" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="cargoRep" class="block text-sm font-medium text-gray-700">Cargo:</label>
                                <input type="text" name="cargoRep" id="cargoRep" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="dirTrabRep" class="block text-sm font-medium text-gray-700">Dirección del Trabajo:</label>
                                <textarea name="dirTrabRep" id="dirTrabRep" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 resize-y"></textarea>
                            </div>
                            <div>
                                <label for="corrRep" class="block text-sm font-medium text-gray-700">Correo Electrónico Representante:</label>
                                <input type="email" name="corrRep" id="corrRep" data-required="true" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="parentesco" class="block text-sm font-medium text-gray-700">Parentesco con el Estudiante:</label>
                                <input type="text" name="parentesco" id="parentesco" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="contEmerg" class="block text-sm font-medium text-gray-700">Contacto de Emergencia:</label>
                                <input type="tel" name="contEmerg" id="contEmerg" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="autRetirar" class="block text-sm font-medium text-gray-700">Personas Autorizadas para Retirar al Menor:</label>
                                <textarea name="autRetirar" id="autRetirar" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 resize-y"></textarea>
                            </div>
                            <div>
                                <label for="referencia" class="block text-sm font-medium text-gray-700">Referencia:</label>
                                <input type="text" name="referencia" id="referencia" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <!-- CAMPOS NUEVOS AÑADIDOS -->
                            <div>
                                <label for="tipoPago" class="block text-sm font-medium text-gray-700">Tipo de Pago:</label>
                                <select name="tipoPago" id="tipoPago" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Selecciona</option>
                                    <option value="Abono">Abono</option>
                                    <option value="Completo">Completo</option>
                                </select>
                            </div>
                            <div>
                                <label for="montoPago" class="block text-sm font-medium text-gray-700">Monto:</label>
                                <input type="text" name="montoPago" id="montoPago" inputmode="numeric" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="moneda" class="block text-sm font-medium text-gray-700">Moneda:</label>
                                <select name="moneda" id="moneda" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="Bolivares">Bolívares</option>
                                    <option value="Divisas">Divisas</option>
                                </select>
                            </div>
                            <div>
                                <label for="bancoPago" class="block text-sm font-medium text-gray-700">Banco:</label>
                                <select name="bancoPago" id="bancoPago" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Selecciona un banco</option>
                                    <option value="Banco de Venezuela">Banco de Venezuela</option>
                                    <option value="Banesco">Banesco</option>
                                    <option value="Mercantil">Mercantil</option>
                                    <option value="Provincial">Provincial</option>
                                    <option value="BOD">BOD</option>
                                    <option value="Bicentenario">Bicentenario</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <div>
                                <label for="mensualidadCancelada" class="block text-sm font-medium text-gray-700">Mensualidad Cancelada:</label>
                                <select name="mensualidadCancelada" id="mensualidadCancelada" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Selecciona un mes</option>
                                    <option value="Enero">Enero</option>
                                    <option value="Febrero">Febrero</option>
                                    <option value="Marzo">Marzo</option>
                                    <option value="Abril">Abril</option>
                                    <option value="Mayo">Mayo</option>
                                    <option value="Junio">Junio</option>
                                    <option value="Julio">Julio</option>
                                    <option value="Agosto">Agosto</option>
                                    <option value="Septiembre">Septiembre</option>
                                    <option value="Octubre">Octubre</option>
                                    <option value="Noviembre">Noviembre</option>
                                    <option value="Diciembre">Diciembre</option>
                                </select>
                            </div>
                            <!-- FIN DE CAMPOS NUEVOS -->
                            <div>
                                <label for="fotoEst" class="block text-sm font-medium text-gray-700">Adjuntar comprobante de pago:</label>
                                <input type="file" name="fotoEst" id="fotoEst" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-100 file:text-indigo-700 hover:file:bg-indigo-200 transition-colors duration-200 cursor-pointer">
                                <input type="hidden" name="fotoEstBase64" id="fotoEstBase64">
                                <img id="imagePreview" src="" alt="Previsualización" class="hidden mt-4 rounded-lg border border-gray-200 w-32 h-32 object-cover">
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
        </form>

        <div class="flex justify-between mt-8">
            <button type="button" id="prevStepBtn" class="hidden flex items-center justify-center gap-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg shadow-sm transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                Anterior
            </button>
            <button type="button" id="nextStepBtn" class="flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-all duration-200">
                Siguiente
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
            </button>
            <button type="submit" form="studentForm" id="submitForm" class="hidden flex items-center justify-center gap-2 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                Generar Ficha
            </button>
        </div>

        <p id="formStatus" class="mt-6 text-center font-semibold hidden"></p>
    </div>

    <div id="confirmationModal" class="fixed inset-0 bg-gray-900 bg-opacity-60 flex justify-center items-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm w-full transform scale-95 transition-transform duration-300">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-5">
                <svg class="h-10 w-10 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-3">¡Ficha Generada!</h2>
            <p class="text-gray-600 mb-6">
                Hemos enviado los documentos a tu correo. Ya puedes cerrar esta ventana.
            </p>
            <button type="button" id="closeModalBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-200">
                Cerrar
            </button>
        </div>
    </div>

    <script>
        // --- TODO EL JAVASCRIPT PERMANECE EXACTAMENTE IGUAL ---
        // No es necesario cambiar la lógica, solo los estilos.
        // Pega aquí el contenido de tu etiqueta <script> anterior.
        const studentForm = document.getElementById('studentForm');
        const formStatus = document.getElementById('formStatus');
        const documentLink = document.getElementById('documentLink');
        const documentLinkAnchor = document.querySelector('#documentLink a');
        const formDescription = document.getElementById('form-description');
        const progressBar = document.getElementById('progressBar');

        const formSteps = document.querySelectorAll('.form-step');
        let currentStepIndex = 0;
        let visibleSteps = [];

        const prevStepBtn = document.getElementById('prevStepBtn');
        const nextStepBtn = document.getElementById('nextStepBtn');
        const submitFormBtn = document.getElementById('submitForm');

        const enableMadreCheckbox = document.getElementById('enableMadre');
        const enablePadreCheckbox = document.getElementById('enablePadre');

        const confirmationModal = document.getElementById('confirmationModal');
        const closeModalBtn = document.getElementById('closeModalBtn');

        const stepDescriptions = {
            'step1': "Por favor, completa los datos del estudiante y selecciona las secciones opcionales.",
            'step2': "Ahora, ingresa los datos de la madre.",
            'step3': "A continuación, ingresa los datos del padre.",
            'step4': "Finalmente, completa los datos del representante en el colegio."
        };

        function updateVisibleSteps() {
            visibleSteps = ['step1'];
            if (enableMadreCheckbox.checked) {
                visibleSteps.push('step2');
            }
            if (enablePadreCheckbox.checked) {
                visibleSteps.push('step3');
            }
            if (document.getElementById('step4')) {
                visibleSteps.push('step4');
            }
            if (currentStepIndex >= visibleSteps.length) {
                currentStepIndex = visibleSteps.length - 1;
            }
            showCurrentStep();
            updateProgressBar();
        }

        function updateProgressBar() {
            const progress = ((currentStepIndex + 1) / visibleSteps.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function showCurrentStep() {
            formSteps.forEach(step => step.classList.remove('active'));
            const currentStepId = visibleSteps[currentStepIndex];
            document.getElementById(currentStepId).classList.add('active');

            formDescription.textContent = stepDescriptions[currentStepId];

            if (currentStepIndex === 0) {
                prevStepBtn.classList.add('hidden');
            } else {
                prevStepBtn.classList.remove('hidden');
            }

            if (currentStepIndex === visibleSteps.length - 1) {
                nextStepBtn.classList.add('hidden');
                submitFormBtn.classList.remove('hidden');
                formStatus.classList.add('hidden');
            } else {
                nextStepBtn.classList.remove('hidden');
                submitFormBtn.classList.add('hidden');
            }
            updateProgressBar();
        }

        function validateCurrentStep() {
            let isValid = true;
            let firstInvalidField = null;

            formStatus.classList.add('hidden');
            formStatus.classList.remove('text-red-600');

            const currentStepDiv = document.querySelector('.form-step.active');
            const requiredInputs = currentStepDiv.querySelectorAll('[data-required="true"]');

            requiredInputs.forEach(field => {
                field.classList.remove('invalid');
                if (field.value.trim() === '') {
                    isValid = false;
                    field.classList.add('invalid');
                    if (!firstInvalidField) firstInvalidField = field;
                }
            });

            if (!isValid) {
                formStatus.textContent = 'Por favor, rellena todos los campos obligatorios.';
                formStatus.classList.remove('hidden');
                formStatus.classList.add('text-red-600');
                if (firstInvalidField) {
                    firstInvalidField.focus();
                }
            }
            return isValid;
        }

        nextStepBtn.addEventListener('click', () => {
            if (validateCurrentStep()) {
                if (currentStepIndex < visibleSteps.length - 1) {
                    currentStepIndex++;
                    showCurrentStep();
                }
            }
        });

        prevStepBtn.addEventListener('click', () => {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                showCurrentStep();
            }
        });

        enableMadreCheckbox.addEventListener('change', updateVisibleSteps);
        enablePadreCheckbox.addEventListener('change', updateVisibleSteps);

        const tieneHermSelect = document.getElementById('tieneHerm');
        const hermanoInfo = document.getElementById('hermanoInfo');

        function toggleHermanoInfo() {
            if (tieneHermSelect.value === 'Sí') {
                hermanoInfo.classList.remove('hidden');
            } else {
                hermanoInfo.classList.add('hidden');
                document.getElementById('nomHerm').value = '';
                document.getElementById('anoHerm').value = '';
            }
        }

        tieneHermSelect.addEventListener('change', toggleHermanoInfo);
        toggleHermanoInfo();

        function populateAnoCursar() {
            const selectElement = document.getElementById('ano_cursar');
            const currentYear = new Date().getFullYear();
            selectElement.innerHTML = '';
            const defaultOption = document.createElement('option');
            defaultOption.value = "";
            defaultOption.textContent = "Selecciona un año";
            selectElement.appendChild(defaultOption);

            for (let i = 0; i < 10; i++) {
                const startYear = currentYear + i;
                const endYear = startYear + 1;
                const option = document.createElement('option');
                option.value = `${startYear}-${endYear}`;
                option.textContent = `${startYear}-${endYear}`;
                selectElement.appendChild(option);
            }
        }
        populateAnoCursar();

        function populateEstatura() {
            const selectElement = document.getElementById('estatura');
            selectElement.innerHTML = '<option value="">Selecciona</option>';
            for (let i = 100; i <= 200; i += 5) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i} cm`;
                selectElement.appendChild(option);
            }
        }
        populateEstatura();

        const fNacEstInput = document.getElementById('fNacEst');
        const edadEstInput = document.getElementById('edadEst');
        const edadWarning = document.getElementById('edadWarning');

        fNacEstInput.addEventListener('change', () => {
            const birthDateStr = fNacEstInput.value;
            if (!birthDateStr) {
                edadEstInput.value = '';
                edadWarning.classList.add('hidden');
                fNacEstInput.classList.remove('invalid');
                return;
            }

            const birthDate = new Date(birthDateStr);
            if (isNaN(birthDate.getTime())) {
                edadEstInput.value = '';
                edadWarning.textContent = 'Fecha inválida.';
                edadWarning.classList.remove('hidden');
                fNacEstInput.classList.add('invalid');
                return;
            }

            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }

            edadEstInput.value = age >= 0 ? age : '';

            if (age < 10 || age > 18) {
                edadWarning.textContent = 'La edad debe estar entre 10 y 18 años.';
                edadWarning.classList.remove('hidden');
                fNacEstInput.classList.add('invalid');
            } else {
                edadWarning.classList.add('hidden');
                fNacEstInput.classList.remove('invalid');
            }
        });

        function restrictToNumbers(event) {
            this.value = this.value.replace(/[^0-9]/g, '');
            if (this.value.trim() !== '') {
                this.classList.remove('invalid');
            }
        }

        function restrictToLetters(event) {
            this.value = this.value.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑüÜ\s]/g, '');
            if (this.value.trim() !== '') {
                this.classList.remove('invalid');
            }
        }

        function restrictToAlphanumericSpecial(event) {
            this.value = this.value.replace(/[^a-zA-Z0-9áéíóúÁÉÍÓÚñÑüÜ\s.,-]/g, '');
            if (this.value.trim() !== '') {
                this.classList.remove('invalid');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('ciEst').addEventListener('input', restrictToNumbers);
            document.getElementById('ciMad').addEventListener('input', restrictToNumbers);
            document.getElementById('ciPad').addEventListener('input', restrictToNumbers);
            document.getElementById('ciRep').addEventListener('input', restrictToNumbers);
            document.getElementById('telHabMad').addEventListener('input', restrictToNumbers);
            document.getElementById('celMad').addEventListener('input', restrictToNumbers);
            document.getElementById('telHabPad').addEventListener('input', restrictToNumbers);
            document.getElementById('celPad').addEventListener('input', restrictToNumbers);
            document.getElementById('telHabRep').addEventListener('input', restrictToNumbers);
            document.getElementById('celRep').addEventListener('input', restrictToNumbers);
            document.getElementById('contEmerg').addEventListener('input', restrictToNumbers);
            document.getElementById('referencia').addEventListener('input', restrictToNumbers);
            document.getElementById('montoPago').addEventListener('input', restrictToNumbers);

            document.getElementById('nomEst').addEventListener('input', restrictToLetters);
            document.getElementById('apeEst').addEventListener('input', restrictToLetters);
            document.getElementById('lugNacEst').addEventListener('input', restrictToLetters);
            document.getElementById('nomMad').addEventListener('input', restrictToLetters);
            document.getElementById('profMad').addEventListener('input', restrictToLetters);
            document.getElementById('cargoMad').addEventListener('input', restrictToLetters);
            document.getElementById('nomPad').addEventListener('input', restrictToLetters);
            document.getElementById('profPad').addEventListener('input', restrictToLetters);
            document.getElementById('cargoPad').addEventListener('input', restrictToLetters);
            document.getElementById('nomRep').addEventListener('input', restrictToLetters);
            document.getElementById('profRep').addEventListener('input', restrictToLetters);
            document.getElementById('cargoRep').addEventListener('input', restrictToLetters);
            document.getElementById('parentesco').addEventListener('input', restrictToLetters);
            document.getElementById('nomHerm').addEventListener('input', restrictToLetters);

            document.getElementById('plantelProc').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('enfDisc').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('actInt').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('trabMad').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('trabPad').addEventListener('input', restrictToAlphanumericSpecial);
            document.getElementById('trabRep').addEventListener('input', restrictToAlphanumericSpecial);
        });

        const fotoEstInput = document.getElementById('fotoEst');
        const fotoEstBase64Input = document.getElementById('fotoEstBase64');
        const imagePreview = document.getElementById('imagePreview');

        fotoEstInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    fotoEstBase64Input.value = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                imagePreview.src = '';
                imagePreview.classList.add('hidden');
                fotoEstBase64Input.value = '';
            }
        });

        studentForm.addEventListener('submit', async (event) => {
            event.preventDefault();

            if (!validateCurrentStep()) {
                return;
            }

            formStatus.textContent = 'Generando ficha... Por favor, espera.';
            formStatus.classList.remove('hidden', 'text-green-600', 'text-red-600');
            formStatus.classList.add('text-gray-800');
            submitFormBtn.disabled = true;
            prevStepBtn.disabled = true;

            try {
                const response = await fetch(studentForm.action, {
                    method: 'POST',
                    body: new FormData(studentForm)
                });

                const data = await response.json();

                if (data.result === 'success') {
                    confirmationModal.classList.remove('opacity-0', 'pointer-events-none');
                    confirmationModal.querySelector('.transform').classList.remove('scale-95');
                } else {
                    formStatus.textContent = `Error: ${data.error || 'Hubo un problema.'}`;
                    formStatus.classList.add('text-red-600');
                    submitFormBtn.disabled = false;
                    prevStepBtn.disabled = false;
                }
            } catch (error) {
                console.error('Error:', error);
                formStatus.textContent = 'Error de conexión.';
                formStatus.classList.add('text-red-600');
                submitFormBtn.disabled = false;
                prevStepBtn.disabled = false;
            }
        });

        closeModalBtn.addEventListener('click', () => {
            confirmationModal.classList.add('opacity-0', 'pointer-events-none');
            confirmationModal.querySelector('.transform').classList.add('scale-95');
            studentForm.reset();
            currentStepIndex = 0;
            updateVisibleSteps();
            showCurrentStep();
            formStatus.classList.add('hidden');
            imagePreview.src = '';
            imagePreview.classList.add('hidden');
            submitFormBtn.disabled = false;
            prevStepBtn.disabled = false;
        });

        updateVisibleSteps();
        showCurrentStep();
    </script>
</body>
</html>
